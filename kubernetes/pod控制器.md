# Pod常用控制器

## ReplicaSet 控制器

ReplicaSet (简称 Rs) 用于确保由其管控的Pod对象副本数在任一时刻都能精确满足期望的数量，ReplicaSet控制器资源启动后会查找集群中匹配其标签选择器的Pod资源对象，当前活动对象的数量与期望的数量不吻合时，多则删除，少则通过Pod模版创建补足，等Pod资源副本数量符合期望值后即数量进入下一轮和解循环。

ReplicaSet 的副本数量，标签选择器甚至是Pod模版都可以随时按需进行修改:

* 修改期望的副本数量会对现存的Pod副本产生直接影响。
* 修改标签选择器可能会使得现有的Pod副本的标签变得不再匹配，此时ReplicaSet控制器要做的不过是不再计入它们而已。
* 创建完成后ReplicaSet也不会再关注Pod对象的实际内容，因此Pod模版的改动也只会对后来新建的Pod副本产生影响

ReplicaSet 能够实现的功能:

* 确保Pod资源对象的数量精确反映期望值: ReplicaSet需要确保由其控制运行的Pod副本数量精确吻合配置中定义的期望值，否则就会自动补足所缺或终止所余.
* 确保Pod健康运行: 探测到由其管控的Pod对象因其所在的工作节点故障而不可用时，自动请求由调度器于其他工作节点创建缺失的Pod副本。
* 弹性伸缩: 业务规模因各种原因时常存在明显波动,在波峰或波谷期间,可以通过ReplicaSet控制器动态调整相关Pod资源对象的数量。 此外，在必要时还可以通过HPA(HroizontalPodAutoscaler)控制器实现Pod资源规模的自动伸缩。


## Deployment 控制器

Deployment 构建于RelicaSet控制器之上，可为Pod和ReplicaSet资源提供声明式更新。Deployment控制器资源的主要职责同样是为了保证Pod资源的健康运行，其大部分功能均可通过调用 ReplicaSet控制器来实现，同时还增添了部分特性:

* 事件和状态查看: 必要时可以查看Deployment对象升级的详细进度和状态
* 回滚: 升级操作完成后发现问题时，支持使用回滚机制将应用返回到前一个或由用户指定的历史记录中的版本上
* 版本记录: 对Deployment对象的每一次操作都予以保存，以供后续可能执行的回滚操作使用
* 暂停和启动: 对于每一次升级，都能够随时暂停和启动
* 多种自动更新方案:
    * Recreate, 即重建更新机制，全面停止，删除旧有的Pod后用新版本替代
    * RollingUpdate, 即滚动升级机制，逐步替换旧有的Pod至新的版本
